{% extends "frappe/templates/web.html" %}

{% block content %}
{{ include_style('healthcare-web.bundle.css') }}
    <div class="portal-full-section">
        <h2>List of Appointments</h2>

        <div class="previous-appointments">
            <h3>Previous Appointments</h3>
            <ol>
                {% for appointment in appointments if getdate(appointment.get("appointment_date")) < frappe.utils.nowdate() %}
                    <li>
                        {{ appointment.get("name") }} {{ appointment.get("appointment_date") }}
                        {{ appointment.get("appointment_time") }} {{ appointment.get("practitioner_name") }}
                    </li>
                {% endfor %}
            </ol>
        </div>

        <div class="upcoming-appointments">
            <h3>Upcoming Appointments</h3>
            <ol>
                {% for appointment in appointments if getdate(appointment.get("appointment_date")) >= frappe.utils.nowdate() %}
                    <li>
                        {{ appointment.get("name") }} {{ appointment.get("appointment_date") }}
                        {{ appointment.get("appointment_time") }} {{ appointment.get("practitioner_name") }}
                        <button class="btn-appointment" onclick="cancelAppointment('{{ appointment.get("name") }}')">Cancel</button>
                    </li>
                {% endfor %}
            </ol>
        </div>
    </div>

    <script>
        function cancelAppointment(appointmentId) {
            let status = 'Cancelled';
            frappe.call({
                method: 'healthcare.healthcare.doctype.patient_appointment.patient_appointment.update_status',
                args: { appointment_id: appointmentId, status: status},
                callback: function(response) {
                    // Handle the response or perform additional actions if needed
                    console.log(response.message);
                }
            });
        }
    </script>
{% endblock %}
